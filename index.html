<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Finan√ßas+ Painel</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root {
    --primary: #38bdf8;
    --primary-dark: #0ea5e9;
    --secondary: #22c55e;
    --danger: #ef4444;
    --warning: #facc15;
    --dark: #0f172a;
    --dark-light: #1e293b;
    --gray: #334155;
    --light: #f8fafc;
    --text-light: #94a3b8;
  }
  
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  
  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, var(--dark), var(--dark-light));
    color: var(--light);
    line-height: 1.6;
    min-height: 100vh;
  }
  
  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
  }
  
  header {
    background: var(--dark-light);
    box-shadow: 0 2px 10px rgba(56,189,248,0.2);
    padding: 20px 0;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  
  .header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
  }
  
  .logo {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .logo h1 {
    color: var(--primary);
    margin: 0;
    font-size: 1.8rem;
  }
  
  .logo-icon {
    font-size: 1.8rem;
  }
  
  .user-info {
    display: flex;
    align-items: center;
    gap: 15px;
  }
  
  .user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--primary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
  }
  
  .welcome-message {
    color: var(--text-light);
    font-size: 0.9rem;
  }
  
  main {
    padding: 30px 0;
  }
  
  .dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }
  
  .card {
    background: var(--dark-light);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 0 15px rgba(56,189,248,0.25);
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease;
  }
  
  .card:hover {
    transform: translateY(-5px);
  }
  
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    border-bottom: 1px solid var(--gray);
    padding-bottom: 10px;
  }
  
  .card-title {
    font-size: 1.2rem;
    color: var(--primary);
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .card-actions {
    display: flex;
    gap: 10px;
  }
  
  .btn {
    padding: 8px 15px;
    border-radius: 8px;
    border: none;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 5px;
  }
  
  .btn-primary {
    background: var(--primary);
    color: var(--dark);
  }
  
  .btn-primary:hover {
    background: var(--primary-dark);
  }
  
  .btn-secondary {
    background: var(--gray);
    color: var(--light);
  }
  
  .btn-secondary:hover {
    background: #475569;
  }
  
  .btn-danger {
    background: var(--danger);
    color: var(--light);
  }
  
  .btn-danger:hover {
    background: #dc2626;
  }
  
  .btn-small {
    padding: 5px 10px;
    font-size: 0.8rem;
  }
  
  .form-group {
    margin-bottom: 15px;
  }
  
  label {
    display: block;
    margin-bottom: 5px;
    color: var(--text-light);
    font-size: 0.9rem;
  }
  
  input, select, textarea {
    width: 100%;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid var(--gray);
    outline: none;
    background: var(--dark);
    color: var(--light);
    font-family: inherit;
  }
  
  input:focus, select:focus, textarea:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 2px rgba(56,189,248,0.2);
  }
  
  .form-row {
    display: flex;
    gap: 15px;
  }
  
  .form-row .form-group {
    flex: 1;
  }
  
  .table-container {
    overflow-x: auto;
    max-height: 400px;
    margin-top: 10px;
  }
  
  table {
    width: 100%;
    border-collapse: collapse;
  }
  
  th, td {
    padding: 12px 15px;
    border-bottom: 1px solid var(--gray);
    text-align: left;
  }
  
  th {
    background: var(--dark);
    color: var(--primary);
    position: sticky;
    top: 0;
  }
  
  tr:hover {
    background: rgba(56,189,248,0.05);
  }
  
  .positivo {
    color: var(--secondary);
    font-weight: bold;
  }
  
  .negativo {
    color: var(--danger);
    font-weight: bold;
  }
  
  .status-badge {
    padding: 4px 8px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: bold;
  }
  
  .badge-renda {
    background: rgba(34,197,94,0.2);
    color: var(--secondary);
  }
  
  .badge-despesa {
    background: rgba(239,68,68,0.2);
    color: var(--danger);
  }
  
  .action-buttons {
    display: flex;
    gap: 5px;
  }
  
  .action-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 5px;
    border-radius: 4px;
    color: var(--text-light);
    transition: all 0.3s ease;
  }
  
  .action-btn:hover {
    background: var(--gray);
    color: var(--light);
  }
  
  .resumo-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
  }
  
  .resumo-card {
    background: var(--dark);
    border-radius: 12px;
    padding: 15px;
    text-align: center;
  }
  
  .resumo-valor {
    font-size: 1.5rem;
    font-weight: bold;
    margin: 10px 0;
  }
  
  .resumo-desc {
    font-size: 0.9rem;
    color: var(--text-light);
  }
  
  .chart-container {
    margin-top: 20px;
    height: 250px;
  }
  
  .filters {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
    flex-wrap: wrap;
  }
  
  .filter-group {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .filter-label {
    color: var(--text-light);
    font-size: 0.9rem;
    white-space: nowrap;
  }
  
  .empty-state {
    text-align: center;
    padding: 30px;
    color: var(--text-light);
  }
  
  .empty-icon {
    font-size: 3rem;
    margin-bottom: 15px;
    opacity: 0.5;
  }
  
  .insight-box {
    background: var(--dark);
    border-radius: 12px;
    padding: 15px;
    margin-top: 20px;
    border-left: 4px solid var(--primary);
  }
  
  .insight-title {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 10px;
    color: var(--primary);
  }
  
  footer {
    text-align: center;
    color: var(--text-light);
    padding: 20px;
    font-size: 0.9rem;
    border-top: 1px solid var(--gray);
    margin-top: 30px;
  }
  
  .tip-rotation {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
  }
  
  .tip {
    max-width: 400px;
  }
  
  @media (max-width: 768px) {
    .header-content {
      flex-direction: column;
      gap: 15px;
    }
    
    .dashboard {
      grid-template-columns: 1fr;
    }
    
    .form-row {
      flex-direction: column;
      gap: 0;
    }
    
    .filters {
      flex-direction: column;
      align-items: flex-start;
    }
  }
</style>
</head>
<body>

<header>
  <div class="container">
    <div class="header-content">
      <div class="logo">
        <span class="logo-icon">üí∞</span>
        <h1>Finan√ßas+</h1>
      </div>
      <div class="user-info">
        <div class="welcome-message">Ol√°, Usu√°rio! Vamos analisar suas finan√ßas hoje?</div>
        <div class="user-avatar">U</div>
      </div>
    </div>
  </div>
</header>

<main class="container">
  <!-- Dashboard de Resumo -->
  <div class="dashboard">
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">üìä Resumo Financeiro</h2>
      </div>
      <div id="resumo" class="resumo-grid">
        <!-- Ser√° preenchido dinamicamente -->
      </div>
      <div class="insight-box">
        <div class="insight-title">
          <span>üí°</span>
          <h3>Insight do Dia</h3>
        </div>
        <p id="insight-text">Carregando...</p>
      </div>
    </div>
    
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">üéØ Metas Financeiras</h2>
        <button class="btn btn-primary btn-small" onclick="abrirModalMeta()">
          <span>+</span> Nova Meta
        </button>
      </div>
      <div id="metas-container">
        <!-- Ser√° preenchido dinamicamente -->
      </div>
    </div>
  </div>

  <!-- Adicionar Transa√ß√µes e Tabela -->
  <div class="dashboard">
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">‚ûï Adicionar Transa√ß√£o</h2>
      </div>
      <form id="form-transacao" onsubmit="adicionar(event)">
        <div class="form-row">
          <div class="form-group">
            <label for="descricao">Descri√ß√£o</label>
            <input type="text" id="descricao" placeholder="Ex: Mercado, Sal√°rio" required>
          </div>
          <div class="form-group">
            <label for="valor">Valor (R$)</label>
            <input type="number" id="valor" step="0.01" min="0" placeholder="0,00" required>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="tipo">Tipo</label>
            <select id="tipo" required>
              <option value="renda">Renda</option>
              <option value="despesa">Despesa</option>
            </select>
          </div>
          <div class="form-group">
            <label for="categoria">Categoria</label>
            <select id="categoria" required>
              <option value="">Selecionar categoria</option>
              <option>Alimenta√ß√£o</option>
              <option>Moradia</option>
              <option>Transporte</option>
              <option>Lazer</option>
              <option>Sa√∫de</option>
              <option>Educa√ß√£o</option>
              <option>Renda Salarial</option>
              <option>Renda Extra</option>
              <option>Outros</option>
            </select>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="data">Data</label>
            <input type="date" id="data" required>
          </div>
          <div class="form-group">
            <label for="notas">Notas (opcional)</label>
            <input type="text" id="notas" placeholder="Adicione observa√ß√µes">
          </div>
        </div>
        
        <button type="submit" class="btn btn-primary">Adicionar Transa√ß√£o</button>
      </form>
    </div>
    
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">üìã Transa√ß√µes Recentes</h2>
        <div class="card-actions">
          <button class="btn btn-secondary btn-small" onclick="exportarDados()">
            <span>üì•</span> Exportar
          </button>
          <button class="btn btn-danger btn-small" onclick="limparTudo()">
            <span>üóëÔ∏è</span> Limpar
          </button>
        </div>
      </div>
      
      <div class="filters">
        <div class="filter-group">
          <span class="filter-label">Filtrar por:</span>
          <select id="filtro-tipo" onchange="aplicarFiltros()">
            <option value="todos">Todos os tipos</option>
            <option value="renda">Renda</option>
            <option value="despesa">Despesa</option>
          </select>
        </div>
        <div class="filter-group">
          <select id="filtro-categoria" onchange="aplicarFiltros()">
            <option value="todos">Todas as categorias</option>
            <!-- Ser√° preenchido dinamicamente -->
          </select>
        </div>
        <div class="filter-group">
          <select id="filtro-mes" onchange="aplicarFiltros()">
            <option value="todos">Todos os meses</option>
            <!-- Ser√° preenchido dinamicamente -->
          </select>
        </div>
      </div>
      
      <div class="table-container">
        <table id="tabela">
          <thead>
            <tr>
              <th>Data</th>
              <th>Descri√ß√£o</th>
              <th>Categoria</th>
              <th>Tipo</th>
              <th>Valor (R$)</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Gr√°ficos -->
  <div class="dashboard">
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">üìà Resumo Geral</h2>
      </div>
      <div class="chart-container">
        <canvas id="graficoGastos"></canvas>
      </div>
    </div>
    
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">ü•ß Distribui√ß√£o por Categoria</h2>
      </div>
      <div class="chart-container">
        <canvas id="graficoCategorias"></canvas>
      </div>
    </div>
  </div>
</main>

<footer>
  <div class="container">
    <div class="tip-rotation">
      <div class="tip">
        üí° Dica do Finan√ßas+: "A cada R$100 que voc√™ economiza, est√° comprando liberdade para o futuro."
      </div>
      <div class="tip" style="display:none;">
        üí° Dica do Finan√ßas+: "Revise seus gastos mensais e identifique onde pode economizar."
      </div>
      <div class="tip" style="display:none;">
        üí° Dica do Finan√ßas+: "Estabele√ßa metas realistas para seus objetivos financeiros."
      </div>
    </div>
  </div>
</footer>

<!-- Modal para Edi√ß√£o de Transa√ß√£o -->
<div id="modal-edicao" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:1000; align-items:center; justify-content:center;">
  <div class="card" style="max-width:500px; width:90%;">
    <div class="card-header">
      <h2 class="card-title">‚úèÔ∏è Editar Transa√ß√£o</h2>
      <button class="action-btn" onclick="fecharModal()">‚úï</button>
    </div>
    <form id="form-edicao" onsubmit="salvarEdicao(event)">
      <input type="hidden" id="edicao-id">
      <div class="form-group">
        <label for="edicao-descricao">Descri√ß√£o</label>
        <input type="text" id="edicao-descricao" required>
      </div>
      <div class="form-group">
        <label for="edicao-valor">Valor (R$)</label>
        <input type="number" id="edicao-valor" step="0.01" min="0" required>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="edicao-tipo">Tipo</label>
          <select id="edicao-tipo" required>
            <option value="renda">Renda</option>
            <option value="despesa">Despesa</option>
          </select>
        </div>
        <div class="form-group">
          <label for="edicao-categoria">Categoria</label>
          <select id="edicao-categoria" required>
            <!-- Ser√° preenchido dinamicamente -->
          </select>
        </div>
      </div>
      <div class="form-group">
        <label for="edicao-data">Data</label>
        <input type="date" id="edicao-data" required>
      </div>
      <div class="form-group">
        <label for="edicao-notas">Notas</label>
        <input type="text" id="edicao-notas">
      </div>
      <div class="form-row">
        <button type="submit" class="btn btn-primary">Salvar Altera√ß√µes</button>
        <button type="button" class="btn btn-secondary" onclick="fecharModal()">Cancelar</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal para Metas -->
<div id="modal-meta" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:1000; align-items:center; justify-content:center;">
  <div class="card" style="max-width:500px; width:90%;">
    <div class="card-header">
      <h2 class="card-title">üéØ Nova Meta Financeira</h2>
      <button class="action-btn" onclick="fecharModalMeta()">‚úï</button>
    </div>
    <form id="form-meta" onsubmit="adicionarMeta(event)">
      <div class="form-group">
        <label for="meta-descricao">Descri√ß√£o da Meta</label>
        <input type="text" id="meta-descricao" placeholder="Ex: Comprar um carro, Viagem..." required>
      </div>
      <div class="form-group">
        <label for="meta-valor">Valor Alvo (R$)</label>
        <input type="number" id="meta-valor" step="0.01" min="0" placeholder="0,00" required>
      </div>
      <div class="form-group">
        <label for="meta-prazo">Prazo</label>
        <input type="date" id="meta-prazo" required>
      </div>
      <div class="form-group">
        <label for="meta-categoria">Categoria</label>
        <select id="meta-categoria">
          <option value="Geral">Geral</option>
          <option>Viagem</option>
          <option>Educa√ß√£o</option>
          <option>Moradia</option>
          <option>Autom√≥vel</option>
          <option>Emerg√™ncia</option>
          <option>Outros</option>
        </select>
      </div>
      <div class="form-row">
        <button type="submit" class="btn btn-primary">Criar Meta</button>
        <button type="button" class="btn btn-secondary" onclick="fecharModalMeta()">Cancelar</button>
      </div>
    </form>
  </div>
</div>

<script>
// Vari√°veis globais
let transacoes = JSON.parse(localStorage.getItem('financas')) || [];
let metas = JSON.parse(localStorage.getItem('metas')) || [];
let chartGastos, chartCategorias;
let transacaoEditando = null;

// Dicas rotativas
const dicas = [
  "üí° Dica do Finan√ßas+: 'A cada R$100 que voc√™ economiza, est√° comprando liberdade para o futuro.'",
  "üí° Dica do Finan√ßas+: 'Revise seus gastos mensais e identifique onde pode economizar.'",
  "üí° Dica do Finan√ßas+: 'Estabele√ßa metas realistas para seus objetivos financeiros.'",
  "üí° Dica do Finan√ßas+: 'Mantenha um fundo de emerg√™ncia equivalente a 3-6 meses de despesas.'",
  "üí° Dica do Finan√ßas+: 'Evite d√≠vidas com juros altos, priorize o pagamento delas.'"
];

// Inicializa√ß√£o
document.addEventListener('DOMContentLoaded', function() {
  // Configurar data atual como padr√£o
  document.getElementById('data').valueAsDate = new Date();
  
  // Inicializar a aplica√ß√£o
  atualizarTudo();
  
  // Rotacionar dicas
  rotacionarDicas();
  setInterval(rotacionarDicas, 8000);
});

function rotacionarDicas() {
  const tips = document.querySelectorAll('.tip');
  let visibleIndex = -1;
  
  // Encontrar a dica vis√≠vel atual
  tips.forEach((tip, index) => {
    if (tip.style.display !== 'none') {
      visibleIndex = index;
      tip.style.display = 'none';
    }
  });
  
  // Mostrar pr√≥xima dica
  const nextIndex = (visibleIndex + 1) % tips.length;
  tips[nextIndex].style.display = 'block';
}

function adicionar(event) {
  event.preventDefault();
  
  const descricao = document.getElementById('descricao').value.trim();
  const valor = parseFloat(document.getElementById('valor').value);
  const tipo = document.getElementById('tipo').value;
  const categoria = document.getElementById('categoria').value || "Outros";
  const data = document.getElementById('data').value;
  const notas = document.getElementById('notas').value.trim();

  if (!descricao || isNaN(valor) || valor <= 0) {
    alert("Por favor, preencha todos os campos corretamente!");
    return;
  }

  const novaTransacao = {
    id: Date.now(),
    descricao,
    valor,
    tipo,
    categoria,
    data,
    notas
  };
  
  transacoes.push(novaTransacao);
  localStorage.setItem('financas', JSON.stringify(transacoes));

  // Limpar formul√°rio
  document.getElementById('form-transacao').reset();
  document.getElementById('data').valueAsDate = new Date();
  
  atualizarTudo();
  
  // Feedback visual
  const btn = document.querySelector('#form-transacao button');
  const originalText = btn.textContent;
  btn.textContent = '‚úì Adicionado!';
  btn.style.background = '#22c55e';
  
  setTimeout(() => {
    btn.textContent = originalText;
    btn.style.background = '';
  }, 1500);
}

function atualizarTabela() {
  const corpo = document.querySelector("#tabela tbody");
  corpo.innerHTML = "";
  
  // Ordenar por data (mais recente primeiro)
  transacoes.sort((a,b) => new Date(b.data) - new Date(a.data));
  
  // Aplicar filtros
  const tipoFiltro = document.getElementById('filtro-tipo').value;
  const categoriaFiltro = document.getElementById('filtro-categoria').value;
  const mesFiltro = document.getElementById('filtro-mes').value;
  
  const transacoesFiltradas = transacoes.filter(t => {
    // Filtro por tipo
    if (tipoFiltro !== 'todos' && t.tipo !== tipoFiltro) return false;
    
    // Filtro por categoria
    if (categoriaFiltro !== 'todos' && t.categoria !== categoriaFiltro) return false;
    
    // Filtro por m√™s
    if (mesFiltro !== 'todos') {
      const transacaoMes = new Date(t.data).toISOString().substring(0, 7);
      if (transacaoMes !== mesFiltro) return false;
    }
    
    return true;
  });
  
  if (transacoesFiltradas.length === 0) {
    corpo.innerHTML = `
      <tr>
        <td colspan="6" class="empty-state">
          <div class="empty-icon">üìù</div>
          <p>Nenhuma transa√ß√£o encontrada</p>
          <p>Tente ajustar os filtros ou adicione uma nova transa√ß√£o</p>
        </td>
      </tr>
    `;
    return;
  }
  
  transacoesFiltradas.forEach(t => {
    const tr = document.createElement("tr");
    const classe = t.tipo === 'renda' ? 'positivo' : 'negativo';
    const badgeClasse = t.tipo === 'renda' ? 'badge-renda' : 'badge-despesa';
    
    tr.innerHTML = `
      <td>${formatarData(t.data)}</td>
      <td>
        <div>${t.descricao}</div>
        ${t.notas ? `<small style="color:var(--text-light)">${t.notas}</small>` : ''}
      </td>
      <td>${t.categoria}</td>
      <td><span class="status-badge ${badgeClasse}">${t.tipo === 'renda' ? 'Renda' : 'Despesa'}</span></td>
      <td class="${classe}">${t.tipo === 'renda' ? '+' : '-'} R$ ${t.valor.toFixed(2)}</td>
      <td>
        <div class="action-buttons">
          <button class="action-btn" onclick="editarTransacao(${t.id})" title="Editar">‚úèÔ∏è</button>
          <button class="action-btn" onclick="excluirTransacao(${t.id})" title="Excluir">üóëÔ∏è</button>
        </div>
      </td>
    `;
    corpo.appendChild(tr);
  });
}

function aplicarFiltros() {
  atualizarTabela();
}

function atualizarFiltros() {
  // Atualizar op√ß√µes de categoria
  const categorias = [...new Set(transacoes.map(t => t.categoria))];
  const selectCategoria = document.getElementById('filtro-categoria');
  const selectCategoriaEdicao = document.getElementById('edicao-categoria');
  
  // Limpar op√ß√µes exceto a primeira
  while (selectCategoria.children.length > 1) {
    selectCategoria.removeChild(selectCategoria.lastChild);
  }
  
  while (selectCategoriaEdicao.children.length > 0) {
    selectCategoriaEdicao.removeChild(selectCategoriaEdicao.lastChild);
  }
  
  // Adicionar categorias
  categorias.forEach(cat => {
    const option = document.createElement('option');
    option.value = cat;
    option.textContent = cat;
    selectCategoria.appendChild(option);
    
    const optionEdicao = document.createElement('option');
    optionEdicao.value = cat;
    optionEdicao.textContent = cat;
    selectCategoriaEdicao.appendChild(optionEdicao);
  });
  
  // Atualizar op√ß√µes de m√™s
  const meses = [...new Set(transacoes.map(t => new Date(t.data).toISOString().substring(0, 7)))].sort().reverse();
  const selectMes = document.getElementById('filtro-mes');
  
  // Limpar op√ß√µes exceto a primeira
  while (selectMes.children.length > 1) {
    selectMes.removeChild(selectMes.lastChild);
  }
  
  // Adicionar meses
  meses.forEach(mes => {
    const option = document.createElement('option');
    option.value = mes;
    const data = new Date(mes + '-01');
    option.textContent = data.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
    selectMes.appendChild(option);
  });
}

function formatarData(dataStr) {
  const data = new Date(dataStr);
  return data.toLocaleDateString('pt-BR');
}

function editarTransacao(id) {
  const transacao = transacoes.find(t => t.id === id);
  if (!transacao) return;
  
  transacaoEditando = id;
  
  // Preencher formul√°rio de edi√ß√£o
  document.getElementById('edicao-id').value = id;
  document.getElementById('edicao-descricao').value = transacao.descricao;
  document.getElementById('edicao-valor').value = transacao.valor;
  document.getElementById('edicao-tipo').value = transacao.tipo;
  document.getElementById('edicao-categoria').value = transacao.categoria;
  document.getElementById('edicao-data').value = transacao.data;
  document.getElementById('edicao-notas').value = transacao.notas || '';
  
  // Mostrar modal
  document.getElementById('modal-edicao').style.display = 'flex';
}

function fecharModal() {
  document.getElementById('modal-edicao').style.display = 'none';
  transacaoEditando = null;
}

function salvarEdicao(event) {
  event.preventDefault();
  
  const id = parseInt(document.getElementById('edicao-id').value);
  const descricao = document.getElementById('edicao-descricao').value.trim();
  const valor = parseFloat(document.getElementById('edicao-valor').value);
  const tipo = document.getElementById('edicao-tipo').value;
  const categoria = document.getElementById('edicao-categoria').value;
  const data = document.getElementById('edicao-data').value;
  const notas = document.getElementById('edicao-notas').value.trim();

  if (!descricao || isNaN(valor) || valor <= 0) {
    alert("Por favor, preencha todos os campos corretamente!");
    return;
  }

  const index = transacoes.findIndex(t => t.id === id);
  if (index !== -1) {
    transacoes[index] = {
      ...transacoes[index],
      descricao,
      valor,
      tipo,
      categoria,
      data,
      notas
    };
    
    localStorage.setItem('financas', JSON.stringify(transacoes));
    fecharModal();
    atualizarTudo();
  }
}

function excluirTransacao(id) {
  if (confirm("Tem certeza que deseja excluir esta transa√ß√£o?")) {
    transacoes = transacoes.filter(t => t.id !== id);
    localStorage.setItem('financas', JSON.stringify(transacoes));
    atualizarTudo();
  }
}

function atualizarResumo() {
  if (transacoes.length === 0) {
    document.getElementById('resumo').innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">üìä</div>
        <p>Nenhuma transa√ß√£o registrada</p>
        <p>Adicione sua primeira transa√ß√£o para ver o resumo</p>
      </div>
    `;
    document.getElementById('insight-text').textContent = "Adicione suas primeiras transa√ß√µes para receber insights personalizados.";
    return;
  }

  const totalRenda = transacoes.filter(t => t.tipo === "renda").reduce((a, b) => a + b.valor, 0);
  const totalDespesa = transacoes.filter(t => t.tipo === "despesa").reduce((a, b) => a + b.valor, 0);
  const saldo = totalRenda - totalDespesa;
  
  // Calcular varia√ß√£o do m√™s anterior (simula√ß√£o)
  const variacao = Math.random() * 20 - 10; // Entre -10% e +10%
  const variacaoTexto = variacao >= 0 ? `+${variacao.toFixed(1)}%` : `${variacao.toFixed(1)}%`;
  const variacaoClasse = variacao >= 0 ? 'positivo' : 'negativo';

  let insight = "";
  if (saldo > 0) {
    insight = "Excelente! Voc√™ terminou no azul. Continue poupando para suas metas!";
  } else if (saldo < 0) {
    insight = "Cuidado! Seu saldo est√° negativo. Vamos revisar gastos e reequilibrar?";
  } else {
    insight = "Voc√™ fechou o m√™s no zero. Boa hora para definir uma meta de economia.";
  }

  document.getElementById("resumo").innerHTML = `
    <div class="resumo-card">
      <div class="resumo-desc">Renda Total</div>
      <div class="resumo-valor positivo">R$ ${totalRenda.toFixed(2)}</div>
    </div>
    <div class="resumo-card">
      <div class="resumo-desc">Despesas Totais</div>
      <div class="resumo-valor negativo">R$ ${totalDespesa.toFixed(2)}</div>
    </div>
    <div class="resumo-card">
      <div class="resumo-desc">Saldo Atual</div>
      <div class="resumo-valor ${saldo >= 0 ? 'positivo' : 'negativo'}">R$ ${saldo.toFixed(2)}</div>
    </div>
    <div class="resumo-card">
      <div class="resumo-desc">Varia√ß√£o</div>
      <div class="resumo-valor ${variacaoClasse}">${variacaoTexto}</div>
    </div>
  `;

  document.getElementById("insight-text").textContent = insight;

  atualizarGraficos(totalRenda, totalDespesa);
}

function atualizarGraficos(renda, despesa) {
  const ctx1 = document.getElementById('graficoGastos');
  const ctx2 = document.getElementById('graficoCategorias');

  if (chartGastos) chartGastos.destroy();
  if (chartCategorias) chartCategorias.destroy();

  // Gr√°fico de barras - Renda vs Despesas
  chartGastos = new Chart(ctx1, {
    type: 'bar',
    data: {
      labels: ['Renda', 'Despesas'],
      datasets: [{
        label: 'Resumo Geral',
        data: [renda, despesa],
        backgroundColor: ['#22c55e', '#ef4444'],
        borderColor: ['#16a34a', '#dc2626'],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { 
        legend: { display: false },
        tooltip: {
          callbacks: {
            label: function(context) {
              return `R$ ${context.raw.toFixed(2)}`;
            }
          }
        }
      },
      scales: {
        y: { 
          beginAtZero: true, 
          ticks: { 
            color: '#f8fafc',
            callback: function(value) {
              return 'R$ ' + value.toFixed(2);
            }
          } 
        },
        x: { 
          ticks: { color: '#f8fafc' } 
        }
      }
    }
  });

  // Gr√°fico de pizza - Distribui√ß√£o por categoria
  const categorias = {};
  transacoes.forEach(t => {
    if (t.tipo === 'despesa') {
      categorias[t.categoria] = (categorias[t.categoria] || 0) + t.valor;
    }
  });

  // Se n√£o h√° despesas, mostrar mensagem
  if (Object.keys(categorias).length === 0) {
    ctx2.getContext('2d').clearRect(0, 0, ctx2.width, ctx2.height);
    ctx2.getContext('2d').fillStyle = '#94a3b8';
    ctx2.getContext('2d').font = '16px Arial';
    ctx2.getContext('2d').textAlign = 'center';
    ctx2.getContext('2d').fillText('Sem dados de despesas', ctx2.width/2, ctx2.height/2);
    return;
  }

  chartCategorias = new Chart(ctx2, {
    type: 'pie',
    data: {
      labels: Object.keys(categorias),
      datasets: [{
        data: Object.values(categorias),
        backgroundColor: [
          '#38bdf8','#facc15','#ef4444','#22c55e',
          '#a855f7','#fb923c','#f87171','#3b82f6','#64748b'
        ],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { 
        legend: { 
          position: 'right',
          labels: { 
            color: '#f8fafc',
            usePointStyle: true,
            padding: 15
          } 
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              const value = context.raw;
              const total = context.dataset.data.reduce((a, b) => a + b, 0);
              const percentage = ((value / total) * 100).toFixed(1);
              return `${context.label}: R$ ${value.toFixed(2)} (${percentage}%)`;
            }
          }
        }
      }
    }
  });
}

function atualizarMetas() {
  const container = document.getElementById('metas-container');
  
  if (metas.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">üéØ</div>
        <p>Nenhuma meta definida</p>
        <p>Crie sua primeira meta financeira</p>
      </div>
    `;
    return;
  }
  
  let html = '';
  metas.forEach(meta => {
    // Calcular progresso (simula√ß√£o)
    const progresso = Math.min(Math.random() * 100, 100);
    const progressoClasse = progresso >= 100 ? 'positivo' : 
                           progresso >= 50 ? 'warning' : 'negativo';
    
    // Calcular dias restantes
    const hoje = new Date();
    const prazo = new Date(meta.prazo);
    const diffTime = prazo - hoje;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    const diasTexto = diffDays > 0 ? `${diffDays} dias restantes` : 'Prazo expirado';
    
    html += `
      <div class="meta-item" style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--gray);">
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
          <strong>${meta.descricao}</strong>
          <span style="font-size: 0.9rem; color: var(--text-light);">${meta.categoria}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
          <span>R$ ${meta.valor.toFixed(2)}</span>
          <span class="${diffDays > 0 ? '' : 'negativo'}">${diasTexto}</span>
        </div>
        <div style="background: var(--dark); border-radius: 10px; height: 10px; overflow: hidden;">
          <div style="background: var(--primary); height: 100%; width: ${progresso}%;"></div>
        </div>
        <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.8rem;">
          <span>Progresso: ${progresso.toFixed(1)}%</span>
          <button class="action-btn" onclick="excluirMeta(${meta.id})" title="Excluir meta">üóëÔ∏è</button>
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

function abrirModalMeta() {
  document.getElementById('modal-meta').style.display = 'flex';
  document.getElementById('meta-prazo').valueAsDate = new Date(new Date().setMonth(new Date().getMonth() + 3));
}

function fecharModalMeta() {
  document.getElementById('modal-meta').style.display = 'none';
}

function adicionarMeta(event) {
  event.preventDefault();
  
  const descricao = document.getElementById('meta-descricao').value.trim();
  const valor = parseFloat(document.getElementById('meta-valor').value);
  const prazo = document.getElementById('meta-prazo').value;
  const categoria = document.getElementById('meta-categoria').value;

  if (!descricao || isNaN(valor) || valor <= 0) {
    alert("Por favor, preencha todos os campos corretamente!");
    return;
  }

  const novaMeta = {
    id: Date.now(),
    descricao,
    valor,
    prazo,
    categoria
  };
  
  metas.push(novaMeta);
  localStorage.setItem('metas', JSON.stringify(metas));

  document.getElementById('form-meta').reset();
  fecharModalMeta();
  atualizarMetas();
}

function excluirMeta(id) {
  if (confirm("Tem certeza que deseja excluir esta meta?")) {
    metas = metas.filter(m => m.id !== id);
    localStorage.setItem('metas', JSON.stringify(metas));
    atualizarMetas();
  }
}

function exportarDados() {
  if (transacoes.length === 0) {
    alert("N√£o h√° dados para exportar.");
    return;
  }
  
  // Criar CSV
  let csv = 'Data,Descri√ß√£o,Categoria,Tipo,Valor,Notas\n';
  transacoes.forEach(t => {
    csv += `"${t.data}","${t.descricao}","${t.categoria}","${t.tipo}","${t.valor}","${t.notas || ''}"\n`;
  });
  
  // Criar arquivo e fazer download
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `financas_${new Date().toISOString().split('T')[0]}.csv`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

function limparTudo() {
  if (confirm("Tem certeza que deseja limpar TODOS os dados? Esta a√ß√£o n√£o pode ser desfeita.")) {
    transacoes = [];
    localStorage.setItem('financas', JSON.stringify(transacoes));
    atualizarTudo();
  }
}

function atualizarTudo() {
  atualizarTabela();
  atualizarFiltros();
  atualizarResumo();
  atualizarMetas();
}
</script>

</body>
                                                       </html>
